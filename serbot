listbot

// plugins/socket/listbots.js
// Listar todos los subbots automÃ¡ticamente
import { listActiveSubbots, getSubbot } from '../../lib/subbotSocket.js'
import { readdirSync, existsSync } from 'fs'
import { join } from 'path'

const SUBBOTS_DIR = './subbots'

let handler = async (m, { conn }) => {
  let userId = m.sender.split('@')[0]
  
  // Obtener lista de subbots activos
  let activeBots = listActiveSubbots()
  let userBot = getSubbot(userId)
  
  // Obtener todos los subbots guardados (sesiones)
  let savedBots = []
  if (existsSync(SUBBOTS_DIR)) {
    try {
      savedBots = readdirSync(SUBBOTS_DIR, { withFileTypes: true })
        .filter(dirent => dirent.isDirectory())
        .map(dirent => {
          let id = dirent.name.replace('bot_', '')
          let isActive = activeBots.some(b => b.id === id)
          let isMine = id === userId
          return { id, isActive, isMine, dir: dirent.name }
        })
    } catch (e) {
      console.error('Error leyendo directorio:', e)
    }
  }
  
  // EstadÃ­sticas
  let totalActive = activeBots.filter(b => b.connected).length
  let totalBots = savedBots.length
  let myActive = userBot && userBot.isConnected ? 1 : 0
  let mySaved = savedBots.filter(b => b.isMine).length
  
  let text = `> . ï¹¡ ï¹Ÿ ðŸ¤– ×„ â¬­ *Â¡sá´œÊ™Ê™á´á´›s á´…Éªsá´˜á´É´ÉªÊ™ÊŸá´‡s!*
  
*ã…¤ê¨¶ã€†â¾ ã…¤×„ã…¤â¸¼ã…¤×„ *ÍœðŸ“Š* ã…¤Ö¢ã…¤â¸±ã…¤á¯­Ö´*
×…ã…¤ð“¸ð“ˆ’ã…¤×„ *á´›á´á´›á´€ÊŸ á´€á´„á´›Éªá´ á´s* :: ${totalActive}
×…ã…¤ð“¸ð“ˆ’ã…¤×„ *á´›á´á´›á´€ÊŸ É¢á´œá´€Ê€á´…á´€á´…á´s* :: ${totalBots}
×…ã…¤ð“¸ð“ˆ’ã…¤×„ *á´›á´œs Ê™á´á´›s* :: ${mySaved} (Activos: ${myActive})`

  // Tu bot (si tienes)
  if (mySaved > 0) {
    text += `\n\n*ã…¤ê¨¶ã€†â¾ ã…¤×„ã…¤â¸¼ã…¤×„ *ÍœðŸ¤–* ã…¤Ö¢ã…¤â¸±ã…¤á¯­Ö´* â€” *á´›á´œs sá´œÊ™Ê™á´á´›s*`
    savedBots.filter(b => b.isMine).forEach(b => {
      let status = b.isActive ? 'ðŸŸ¢ Conectado' : 'ðŸ”´ Desconectado'
      text += `\n×…ã…¤ð“¸ð“ˆ’ã…¤×„ *${b.id}* :: ${status}`
    })
  }
  
  // Todos los bots (siempre visible, no necesita --all)
  if (totalBots > 0) {
    text += `\n\n*ã…¤ê¨¶ã€†â¾ ã…¤×„ã…¤â¸¼ã…¤×„ *ÍœðŸŒ* ã…¤Ö¢ã…¤â¸±ã…¤á¯­Ö´* â€” *á´›á´á´…á´s ÊŸá´s sá´œÊ™Ê™á´á´›s*`
    savedBots.forEach(b => {
      let status = b.isActive ? 'ðŸŸ¢' : 'ðŸ”´'
      let owner = b.isMine ? ' (TÃº)' : ''
      text += `\n×…ã…¤ð“¸ð“ˆ’ã…¤×„ ${status} *${b.id}*${owner}`
    })
  }
  
  text += `\n\n> ## \`á´„á´á´á´€É´á´…á´s âš”ï¸\`
> â€¢ .qr - Crear subbot con QR
> â€¢ .code - Crear con cÃ³digo
> â€¢ .stopsocket - Detener tu subbot`

  conn.sendMessage(m.chat, {
    text,
    mentions: [m.sender]
  }, { quoted: m })
}

handler.help = ['bots', 'listbots', 'subbots']
handler.tags = ['socket']
handler.command = ['bots', 'listbots', 'listbot', 'subbots', 'misbots']

export default handler